function l(t){if(!t.viewports)return t;const{viewports:e}=t,r={...t};delete r.viewports;const o=Array.isArray(e)?e:Object.keys(e);if(!o.length)return t;const n=i=>Array.isArray(e)?i:e[i],s={...t.variants};return o.slice(1).forEach(i=>s[i]={viewport:n(i)}),r.viewport=n(o[0]),r.variants=s,o.length>1&&(r.defaultVariantSuffix=o[0]),r}function a(t,e){const r=Object.assign({},t,e);return!t.viewport||typeof t.viewport=="string"?e.viewport&&(r.viewport=e.viewport):e.viewport&&(typeof e.viewport=="object"?r.viewport={...t.viewport,...e.viewport}:r.viewport=e.viewport),t.variants&&(r.variants=a(t.variants,e.variants||{})),r}function d(t,e){if(e.isDefault)return t;const r=Object.assign({},t),o=r.variants||{};delete r.variants;const n=e.keys[0]&&e.keys[0]===t.defaultVariantSuffix?1:0;return e.keys.slice(n).reduce((s,i)=>a(s,o[i]),r)}function c(t){const e=window;if(e.emitCapture)return t(e)}function u(t){const{searchParams:e}=new URL(t),r=e.get("id"),o=e.get("selectedKind"),n=e.get("selectedStory");if(r)return r;if(o&&n)return`${o}/${n}`;throw new Error}function v(t=0){return new Promise(e=>setTimeout(e,t))}function w(t){if(!t)return Promise.resolve();if(typeof t=="string"){const e=window[t];return typeof e!="function"?Promise.resolve():Promise.resolve().then(()=>e())}else return typeof t=="function"?t():Promise.resolve()}function h(t){return new Promise(e=>t.requestIdleCallback(e,{timeout:3e3}))}function S(t,e,r){e&&(t.optionStore||(t.optionStore={}),t.optionStore[e]||(t.optionStore[e]=[]),t.optionStore[e].push(r))}function O(t,e){if(!t.optionStore||!t.optionStore[e])return null;const r=t.optionStore[e];return delete t.optionStore[e],r}function y(t={},e){let r;e&&e.id?r=e.id:e&&e.story&&e.kind?r=e.kind+"/"+e.story:r=u(location.href),c(o=>S(o,r,t))}function m(){c(async t=>{await t.waitBrowserMetricsStable();const[e,r]=await Promise.all([t.getBaseScreenshotOptions(),t.getCurrentVariantKey()]),o=u(location.href),n=O(t,o);if(!n)return;const s=n.reduce((f,p)=>a(f,l(p)),e),i=d(s,r);if(i.skip)return t.emitCapture(i,o);await v(i.delay),await w(i.waitFor),await h(t),await t.emitCapture(i,o)})}function P(t,e){y(t,e),Promise.resolve().then(m)}var _={};const{makeDecorator:k}=__STORYBOOK_MODULE_PREVIEW_API__,g=k({name:"withScreenshot",parameterName:"screenshot",skipIfNoParametersOrOptions:!1,wrapper:(t,e,{parameters:r,options:o})=>(typeof process<"u"&&(process==null?void 0:_.JEST_WORKER_ID)!==void 0||P(r||o,e),t(e))}),D=g,E={parameters:{controls:{matchers:{color:/(background|color)$/i,date:/Date$/i}}}},V=[D];export{V as decorators,E as default};
